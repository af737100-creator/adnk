<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ - ØªØ¹Ù„ÙŠÙ…ÙŠ</title>
    <meta name="description" content="Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª ÙˆØ§Ù„Ø¯ÙˆØ±Ø§Øª">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="../assets/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../assets/icons/favicon-16x16.png">
    <link rel="apple-touch-icon" href="../assets/icons/apple-touch-icon.png">
    <link rel="manifest" href="../manifest.json">
    
    <!-- Styles -->
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/dashboard.css">
    <link rel="stylesheet" href="../styles/responsive.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="profile-page">
    <div class="profile-container">
        <!-- Cover Image -->
        <div class="profile-cover">
            <div class="cover-image" id="cover-image">
                <div class="cover-actions">
                    <button class="btn-cover" onclick="changeCover()">
                        <i class="fas fa-camera"></i>
                        ØªØºÙŠÙŠØ± Ø§Ù„ØºÙ„Ø§Ù
                    </button>
                </div>
            </div>
            
            <div class="profile-header">
                <div class="profile-avatar-wrapper">
                    <div class="profile-avatar" id="profile-avatar">
                        <img src="../assets/images/placeholder/avatar-placeholder.png" alt="Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©">
                    </div>
                    <button class="btn-avatar-edit" onclick="editAvatar()">
                        <i class="fas fa-camera"></i>
                    </button>
                </div>
                
                <div class="profile-info">
                    <h1 id="profile-name">Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯</h1>
                    <p id="profile-title">Ù…Ø¹Ù„Ù… Ø¨Ø±Ù…Ø¬Ø©</p>
                    <p id="profile-location">
                        <i class="fas fa-map-marker-alt"></i>
                        Ø§Ù„Ø±ÙŠØ§Ø¶ØŒ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©
                    </p>
                </div>
                
                <div class="profile-actions">
                    <button class="btn-primary" onclick="editProfile()">
                        <i class="fas fa-edit"></i>
                        ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
                    </button>
                    <button class="btn-secondary" onclick="shareProfile()">
                        <i class="fas fa-share-alt"></i>
                        Ù…Ø´Ø§Ø±ÙƒØ©
                    </button>
                </div>
            </div>
        </div>

        <!-- Profile Content -->
        <div class="profile-content">
            <!-- Sidebar -->
            <div class="profile-sidebar">
                <div class="stats-card">
                    <h3>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-value" id="stat-courses">12</span>
                            <span class="stat-label">Ø¯ÙˆØ±Ø©</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="stat-students">245</span>
                            <span class="stat-label">Ø·Ø§Ù„Ø¨</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="stat-rating">4.8</span>
                            <span class="stat-label">ØªÙ‚ÙŠÙŠÙ…</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="stat-certificates">8</span>
                            <span class="stat-label">Ø´Ù‡Ø§Ø¯Ø©</span>
                        </div>
                    </div>
                </div>
                
                <div class="bio-card">
                    <h3>Ù†Ø¨Ø°Ø© Ø¹Ù†ÙŠ</h3>
                    <p id="profile-bio">
                        Ù…Ø¹Ù„Ù… Ø¨Ø±Ù…Ø¬Ø© Ø¨Ø®Ø¨Ø±Ø© 5 Ø³Ù†ÙˆØ§Øª ÙÙŠ ØªØ¯Ø±ÙŠØ³ Python Ùˆ JavaScript. 
                        Ø£Ø³Ø¹Ù‰ Ù„Ø¬Ø¹Ù„ Ø§Ù„ØªØ¹Ù„Ù… Ù…Ù…ØªØ¹Ø§Ù‹ ÙˆØªÙØ§Ø¹Ù„ÙŠØ§Ù‹ Ù„Ù„Ø¬Ù…ÙŠØ¹.
                    </p>
                </div>
                
                <div class="social-card">
                    <h3>Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙˆØ§ØµÙ„</h3>
                    <div class="social-links" id="social-links">
                        <a href="#" class="social-link twitter">
                            <i class="fab fa-twitter"></i>
                            <span>@ta3lemi</span>
                        </a>
                        <a href="#" class="social-link linkedin">
                            <i class="fab fa-linkedin"></i>
                            <span>mohammed-ahmed</span>
                        </a>
                        <a href="#" class="social-link github">
                            <i class="fab fa-github"></i>
                            <span>mohammed-dev</span>
                        </a>
                        <a href="#" class="social-link youtube">
                            <i class="fab fa-youtube"></i>
                            <span>@ta3lemi</span>
                        </a>
                    </div>
                </div>
                
                <div class="skills-card">
                    <h3>Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</h3>
                    <div class="skills-tags" id="skills-tags">
                        <span class="skill-tag">Python</span>
                        <span class="skill-tag">JavaScript</span>
                        <span class="skill-tag">HTML/CSS</span>
                        <span class="skill-tag">React</span>
                        <span class="skill-tag">Node.js</span>
                        <span class="skill-tag">SQL</span>
                    </div>
                </div>
                
                <div class="achievements-card">
                    <h3>Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</h3>
                    <div class="achievements-list" id="achievements-list">
                        <div class="achievement-item">
                            <div class="achievement-icon">
                                <i class="fas fa-trophy" style="color: #ffd700;"></i>
                            </div>
                            <div class="achievement-info">
                                <h4>Ù…Ø¹Ù„Ù… Ù…ØªÙ…ÙŠØ²</h4>
                                <p>Ø­ØµÙ„ Ø¹Ù„Ù‰ 100 ØªÙ‚ÙŠÙŠÙ… 5 Ù†Ø¬ÙˆÙ…</p>
                                <small>Ù…Ù†Ø° Ø´Ù‡Ø±ÙŠÙ†</small>
                            </div>
                        </div>
                        <div class="achievement-item">
                            <div class="achievement-icon">
                                <i class="fas fa-certificate" style="color: #4299e1;"></i>
                            </div>
                            <div class="achievement-info">
                                <h4>Ù…Ø¯Ø±Ø¨ Ù…Ø¹ØªÙ…Ø¯</h4>
                                <p>Ø´Ù‡Ø§Ø¯Ø© Ù…Ø¯Ø±Ø¨ Ù…Ø¹ØªÙ…Ø¯ Ù…Ù† ØªØ¹Ù„ÙŠÙ…ÙŠ</p>
                                <small>Ù…Ù†Ø° 6 Ø£Ø´Ù‡Ø±</small>
                            </div>
                        </div>
                        <div class="achievement-item">
                            <div class="achievement-icon">
                                <i class="fas fa-users" style="color: #48bb78;"></i>
                            </div>
                            <div class="achievement-info">
                                <h4>Ù…Ø¬ØªÙ…Ø¹ Ù†Ø´Ø·</h4>
                                <p>ÙˆØµÙ„ Ø¹Ø¯Ø¯ Ø·Ù„Ø§Ø¨Ù‡ Ø¥Ù„Ù‰ 200+</p>
                                <small>Ù…Ù†Ø° Ø£Ø³Ø¨ÙˆØ¹</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="profile-main">
                <!-- Tabs -->
                <div class="profile-tabs">
                    <button class="tab-btn active" data-tab="courses">
                        <i class="fas fa-video"></i>
                        Ø§Ù„Ø¯ÙˆØ±Ø§Øª
                    </button>
                    <button class="tab-btn" data-tab="activity">
                        <i class="fas fa-history"></i>
                        Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª
                    </button>
                    <button class="tab-btn" data-tab="reviews">
                        <i class="fas fa-star"></i>
                        Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
                    </button>
                    <button class="tab-btn" data-tab="certificates">
                        <i class="fas fa-certificate"></i>
                        Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª
                    </button>
                </div>

                <!-- Courses Tab -->
                <div id="courses-tab" class="tab-content active">
                    <div class="courses-header">
                        <h2>Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø©</h2>
                        <a href="my-courses.html" class="view-all">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</a>
                    </div>
                    
                    <div class="courses-grid" id="profile-courses">
                        <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ù‡Ù†Ø§ -->
                        <div class="loading-state">
                            <i class="fas fa-spinner fa-spin"></i>
                            <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±Ø§Øª...</p>
                        </div>
                    </div>
                </div>

                <!-- Activity Tab -->
                <div id="activity-tab" class="tab-content">
                    <h2>Ø¢Ø®Ø± Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª</h2>
                    <div class="activity-timeline" id="profile-activity">
                        <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª Ù‡Ù†Ø§ -->
                        <div class="loading-state">
                            <i class="fas fa-spinner fa-spin"></i>
                            <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª...</p>
                        </div>
                    </div>
                </div>

                <!-- Reviews Tab -->
                <div id="reviews-tab" class="tab-content">
                    <div class="reviews-header">
                        <h2>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</h2>
                        <div class="rating-summary">
                            <span class="avg-rating" id="avg-rating">4.8</span>
                            <div class="stars">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star-half-alt"></i>
                            </div>
                            <span class="total-reviews" id="total-reviews">124 ØªÙ‚ÙŠÙŠÙ…</span>
                        </div>
                    </div>
                    
                    <div class="reviews-list" id="reviews-list">
                        <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ù‡Ù†Ø§ -->
                        <div class="loading-state">
                            <i class="fas fa-spinner fa-spin"></i>
                            <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª...</p>
                        </div>
                    </div>
                </div>

                <!-- Certificates Tab -->
                <div id="certificates-tab" class="tab-content">
                    <h2>Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</h2>
                    <div class="certificates-grid" id="certificates-grid">
                        <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ù‡Ù†Ø§ -->
                        <div class="certificate-card">
                            <div class="certificate-icon">
                                <i class="fas fa-certificate"></i>
                            </div>
                            <h4>Ù…Ø¯Ø±Ø¨ Ù…Ø¹ØªÙ…Ø¯</h4>
                            <p>ØªÙ… Ø¥ØµØ¯Ø§Ø±Ù‡Ø§ ÙÙŠ 15 ÙŠÙ†Ø§ÙŠØ± 2026</p>
                            <span class="certificate-badge">Ù…Ø¹ØªÙ…Ø¯Ø©</span>
                        </div>
                        
                        <div class="certificate-card">
                            <div class="certificate-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <h4>Ø£ÙØ¶Ù„ Ù…Ø¹Ù„Ù…</h4>
                            <p>Ø¬Ø§Ø¦Ø²Ø© Ø§Ù„ØªÙ…ÙŠØ² ÙÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ…</p>
                            <span class="certificate-badge">2025</span>
                        </div>
                        
                        <div class="certificate-card">
                            <div class="certificate-icon">
                                <i class="fas fa-award"></i>
                            </div>
                            <h4>Ù…Ø­ØªÙˆÙ‰ Ù…ØªÙ…ÙŠØ²</h4>
                            <p>Ø£ÙƒØ«Ø± Ù…Ù† 1000 Ø³Ø§Ø¹Ø© ØªØ¹Ù„ÙŠÙ…</p>
                            <span class="certificate-badge">Ø¨Ù„Ø§ØªÙŠÙ†ÙŠÙˆÙ…</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div id="edit-profile-modal" class="modal modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-profile-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="edit-name">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                            <input type="text" id="edit-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„">
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-title">Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</label>
                            <input type="text" id="edit-title" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø¹Ù„Ù… Ø¨Ø±Ù…Ø¬Ø©">
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-location">Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
                            <input type="text" id="edit-location" placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©ØŒ Ø§Ù„Ø¯ÙˆÙ„Ø©">
                        </div>
                        
                        <div class="form-group full-width">
                            <label for="edit-bio">Ù†Ø¨Ø°Ø© Ø¹Ù†ÙŠ</label>
                            <textarea id="edit-bio" rows="4" placeholder="Ø§ÙƒØªØ¨ Ù†Ø¨Ø°Ø© Ù…Ø®ØªØµØ±Ø© Ø¹Ù†Ùƒ..."></textarea>
                        </div>
                        
                        <div class="form-group full-width">
                            <label>Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</label>
                            <div class="skills-input">
                                <input type="text" id="skill-input" placeholder="Ø£Ø¶Ù Ù…Ù‡Ø§Ø±Ø© Ø«Ù… Ø§Ø¶ØºØ· Enter">
                                <div class="skills-list" id="edit-skills-list"></div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-twitter">ØªÙˆÙŠØªØ±</label>
                            <div class="social-input">
                                <span>@</span>
                                <input type="text" id="edit-twitter" placeholder="username">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-linkedin">Ù„ÙŠÙ†ÙƒØ¯ Ø¥Ù†</label>
                            <input type="text" id="edit-linkedin" placeholder="linkedin.com/in/username">
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-github">Ø¬ÙŠØª Ù‡Ø§Ø¨</label>
                            <input type="text" id="edit-github" placeholder="github.com/username">
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-youtube">ÙŠÙˆØªÙŠÙˆØ¨</label>
                            <input type="text" id="edit-youtube" placeholder="youtube.com/@username">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeEditModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn-primary" onclick="saveProfile()">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../scripts/utils.js"></script>
    <script src="../scripts/supabase-client.js"></script>
    <script src="../scripts/auth.js"></script>
    <script>
        /**
         * ØªÙ‡ÙŠØ¦Ø© ØµÙØ­Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
         */
        let currentUser = null;
        let profileUserId = null;
        
        document.addEventListener('DOMContentLoaded', async () => {
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
            const urlParams = new URLSearchParams(window.location.search);
            profileUserId = urlParams.get('id');
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
            const isAuth = await auth.requireAuth();
            if (!isAuth && !profileUserId) {
                window.location.href = '../index.html';
                return;
            }
            
            // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            await loadProfileData();
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±Ø§Øª
            await loadUserCourses();
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª
            await loadUserActivity();
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
            await loadUserReviews();
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ†
            setupEventListeners();
        });

        /**
         * ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
         */
        async function loadProfileData() {
            try {
                let userId = profileUserId;
                
                if (!userId) {
                    const user = auth.getCurrentUser();
                    if (user) {
                        userId = user.id;
                    }
                }
                
                if (!userId) return;
                
                const { data: user, error } = await supabase.client
                    .from('users')
                    .select(`
                        *,
                        courses:user_id (count),
                        enrollments:student_id (count)
                    `)
                    .eq('id', userId)
                    .single();
                
                if (error) throw error;
                
                currentUser = user;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                document.getElementById('profile-name').textContent = user.full_name || 'Ù…Ø³ØªØ®Ø¯Ù…';
                document.getElementById('profile-title').textContent = user.job_title || 'Ù…Ø¹Ù„Ù…';
                document.getElementById('profile-location').innerHTML = `
                    <i class="fas fa-map-marker-alt"></i>
                    ${user.location || 'Ø§Ù„Ø±ÙŠØ§Ø¶ØŒ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©'}
                `;
                document.getElementById('profile-bio').textContent = user.bio || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø¨Ø°Ø© ØªØ¹Ø±ÙŠÙÙŠØ©';
                
                if (user.avatar_url) {
                    document.querySelector('#profile-avatar img').src = user.avatar_url;
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                document.getElementById('stat-courses').textContent = user.courses?.[0]?.count || 0;
                document.getElementById('stat-students').textContent = user.enrollments?.[0]?.count || 0;
                document.getElementById('stat-rating').textContent = user.average_rating?.toFixed(1) || '0.0';
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©
                updateSocialLinks(user);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª
                if (user.skills) {
                    updateSkills(user.skills);
                }
                
            } catch (error) {
                console.error('Load profile error:', error);
                showError('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ');
            }
        }

        /**
         * ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©
         */
        function updateSocialLinks(user) {
            const socialLinks = document.getElementById('social-links');
            socialLinks.innerHTML = '';
            
            if (user.twitter) {
                socialLinks.innerHTML += `
                    <a href="https://twitter.com/${user.twitter}" class="social-link twitter" target="_blank">
                        <i class="fab fa-twitter"></i>
                        <span>@${user.twitter}</span>
                    </a>
                `;
            }
            
            if (user.linkedin) {
                socialLinks.innerHTML += `
                    <a href="https://linkedin.com/in/${user.linkedin}" class="social-link linkedin" target="_blank">
                        <i class="fab fa-linkedin"></i>
                        <span>${user.linkedin}</span>
                    </a>
                `;
            }
            
            if (user.github) {
                socialLinks.innerHTML += `
                    <a href="https://github.com/${user.github}" class="social-link github" target="_blank">
                        <i class="fab fa-github"></i>
                        <span>${user.github}</span>
                    </a>
                `;
            }
            
            if (user.youtube) {
                socialLinks.innerHTML += `
                    <a href="https://youtube.com/@${user.youtube}" class="social-link youtube" target="_blank">
                        <i class="fab fa-youtube"></i>
                        <span>@${user.youtube}</span>
                    </a>
                `;
            }
        }

        /**
         * ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª
         */
        function updateSkills(skills) {
            const skillsTags = document.getElementById('skills-tags');
            skillsTags.innerHTML = '';
            
            if (skills && skills.length > 0) {
                skills.forEach(skill => {
                    skillsTags.innerHTML += `<span class="skill-tag">${skill}</span>`;
                });
            }
        }

        /**
         * ØªØ­Ù…ÙŠÙ„ Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
         */
        async function loadUserCourses() {
            try {
                let userId = profileUserId || auth.getCurrentUser()?.id;
                if (!userId) return;
                
                const { data: courses, error } = await supabase.client
                    .from('courses')
                    .select('*')
                    .eq('user_id', userId)
                    .eq('status', 'published')
                    .order('created_at', { ascending: false })
                    .limit(6);
                
                if (error) throw error;
                
                const coursesGrid = document.getElementById('profile-courses');
                
                if (!courses || courses.length === 0) {
                    coursesGrid.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-video"></i>
                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙˆØ±Ø§Øª Ù…Ù†Ø´ÙˆØ±Ø© Ø¨Ø¹Ø¯</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                
                courses.forEach(course => {
                    html += `
                        <div class="course-card">
                            <div class="course-thumbnail">
                                <img src="${course.thumbnail_url || '../assets/images/default-thumbnail.jpg'}" 
                                     alt="${course.title}"
                                     onerror="this.src='../assets/images/default-thumbnail.jpg'">
                                <span class="course-duration">${Utils.formatTime(course.duration || 0)}</span>
                            </div>
                            <div class="course-info">
                                <h4>${course.title}</h4>
                                <p>${Utils.truncate(course.description || '', 80)}</p>
                                <div class="course-meta">
                                    <span>
                                        <i class="fas fa-users"></i>
                                        ${course.total_students || 0}
                                    </span>
                                    <span>
                                        <i class="fas fa-star"></i>
                                        ${(course.average_rating || 0).toFixed(1)}
                                    </span>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                coursesGrid.innerHTML = html;
                
            } catch (error) {
                console.error('Load user courses error:', error);
            }
        }

        /**
         * ØªØ­Ù…ÙŠÙ„ Ù†Ø´Ø§Ø·Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
         */
        async function loadUserActivity() {
            try {
                let userId = profileUserId || auth.getCurrentUser()?.id;
                if (!userId) return;
                
                const { data: activities, error } = await supabase.client
                    .from('activity_logs')
                    .select('*')
                    .eq('user_id', userId)
                    .order('created_at', { ascending: false })
                    .limit(10);
                
                if (error) throw error;
                
                const timeline = document.getElementById('profile-activity');
                
                if (!activities || activities.length === 0) {
                    timeline.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-history"></i>
                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø´Ø§Ø·Ø§Øª Ø­Ø¯ÙŠØ«Ø©</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                
                activities.forEach(activity => {
                    const date = Utils.formatDate(activity.created_at, 'relative');
                    let icon = 'fa-circle';
                    let color = '#4299e1';
                    
                    switch (activity.action) {
                        case 'course_created':
                            icon = 'fa-plus-circle';
                            color = '#48bb78';
                            break;
                        case 'course_published':
                            icon = 'fa-check-circle';
                            color = '#48bb78';
                            break;
                        case 'course_edited':
                            icon = 'fa-edit';
                            color = '#4299e1';
                            break;
                        case 'student_enrolled':
                            icon = 'fa-user-plus';
                            color = '#9f7aea';
                            break;
                    }
                    
                    html += `
                        <div class="timeline-item">
                            <div class="timeline-icon" style="background-color: ${color}20; color: ${color};">
                                <i class="fas ${icon}"></i>
                            </div>
                            <div class="timeline-content">
                                <h4>${getActivityText(activity)}</h4>
                                <span class="timeline-date">${date}</span>
                            </div>
                        </div>
                    `;
                });
                
                timeline.innerHTML = html;
                
            } catch (error) {
                console.error('Load activity error:', error);
            }
        }

        /**
         * ØªØ­Ù…ÙŠÙ„ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
         */
        async function loadUserReviews() {
            try {
                let userId = profileUserId || auth.getCurrentUser()?.id;
                if (!userId) return;
                
                const { data: ratings, error } = await supabase.client
                    .from('course_ratings')
                    .select(`
                        *,
                        course:course_id (title, thumbnail_url),
                        user:user_id (full_name, avatar_url)
                    `)
                    .eq('course.user_id', userId)
                    .order('created_at', { ascending: false })
                    .limit(10);
                
                if (error) throw error;
                
                // ØªØ­Ø¯ÙŠØ« Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
                if (ratings && ratings.length > 0) {
                    const avgRating = ratings.reduce((acc, r) => acc + r.rating, 0) / ratings.length;
                    document.getElementById('avg-rating').textContent = avgRating.toFixed(1);
                    document.getElementById('total-reviews').textContent = `${ratings.length} ØªÙ‚ÙŠÙŠÙ…`;
                }
                
                const reviewsList = document.getElementById('reviews-list');
                
                if (!ratings || ratings.length === 0) {
                    reviewsList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-star"></i>
                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø¨Ø¹Ø¯</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                
                ratings.forEach(rating => {
                    const date = Utils.formatDate(rating.created_at, 'relative');
                    const stars = Array(5).fill().map((_, i) => 
                        i < rating.rating ? 'fas fa-star' : 'far fa-star'
                    ).join(' ');
                    
                    html += `
                        <div class="review-item">
                            <div class="reviewer">
                                <div class="reviewer-avatar">
                                    ${rating.user?.avatar_url 
                                        ? `<img src="${rating.user.avatar_url}" alt="${rating.user.full_name}">`
                                        : `<span>${auth.getInitials(rating.user?.full_name || 'Ø·Ø§Ù„Ø¨')}</span>`
                                    }
                                </div>
                                <div class="reviewer-info">
                                    <h4>${rating.user?.full_name || 'Ø·Ø§Ù„Ø¨'}</h4>
                                    <div class="review-meta">
                                        <span class="review-course">
                                            ${rating.course?.title || 'Ø¯ÙˆØ±Ø©'}
                                        </span>
                                        <span class="review-date">${date}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="review-content">
                                <div class="review-stars">
                                    ${stars.split(' ').map(s => `<i class="${s}"></i>`).join(' ')}
                                </div>
                                ${rating.review_content ? `<p>${rating.review_content}</p>` : ''}
                            </div>
                        </div>
                    `;
                });
                
                reviewsList.innerHTML = html;
                
            } catch (error) {
                console.error('Load reviews error:', error);
            }
        }

        /**
         * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†Øµ Ø§Ù„Ù†Ø´Ø§Ø·
         */
        function getActivityText(activity) {
            switch (activity.action) {
                case 'course_created':
                    return `ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø¯ÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©: ${activity.new_data?.title || ''}`;
                case 'course_published':
                    return `ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø¯ÙˆØ±Ø©: ${activity.new_data?.title || ''}`;
                case 'course_edited':
                    return `ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±Ø©: ${activity.new_data?.title || ''}`;
                case 'student_enrolled':
                    return `Ø§Ù†Ø¶Ù… Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ø¥Ù„Ù‰ Ø§Ù„Ø¯ÙˆØ±Ø©: ${activity.new_data?.course_title || ''}`;
                default:
                    return activity.action.replace(/_/g, ' ');
            }
        }

        /**
         * Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
         */
        function setupEventListeners() {
            // Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    e.target.closest('.tab-btn').classList.add('active');
                    document.getElementById(`${e.target.closest('.tab-btn').dataset.tab}-tab`).classList.add('active');
                });
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ø§Ø±Ø§Øª
            const skillInput = document.getElementById('skill-input');
            if (skillInput) {
                skillInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        addSkill(skillInput.value);
                        skillInput.value = '';
                    }
                });
            }
        }

        /**
         * ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
         */
        function editProfile() {
            const user = currentUser || auth.getCurrentUser();
            if (!user) return;
            
            // Ù…Ù„Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            document.getElementById('edit-name').value = user.full_name || '';
            document.getElementById('edit-title').value = user.job_title || '';
            document.getElementById('edit-location').value = user.location || '';
            document.getElementById('edit-bio').value = user.bio || '';
            document.getElementById('edit-twitter').value = user.twitter || '';
            document.getElementById('edit-linkedin').value = user.linkedin || '';
            document.getElementById('edit-github').value = user.github || '';
            document.getElementById('edit-youtube').value = user.youtube || '';
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª
            const skillsList = document.getElementById('edit-skills-list');
            skillsList.innerHTML = '';
            if (user.skills && user.skills.length > 0) {
                user.skills.forEach(skill => {
                    addSkillTag(skill);
                });
            }
            
            document.getElementById('edit-profile-modal').style.display = 'flex';
        }

        /**
         * Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
         */
        function closeEditModal() {
            document.getElementById('edit-profile-modal').style.display = 'none';
        }

        /**
         * Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ø§Ø±Ø©
         */
        function addSkill(skill) {
            if (!skill.trim()) return;
            
            const skillsList = document.getElementById('edit-skills-list');
            addSkillTag(skill.trim(), skillsList);
        }

        /**
         * Ø¥Ø¶Ø§ÙØ© ÙˆØ³ÙˆÙ… Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª
         */
        function addSkillTag(skill, container = null) {
            const skillsList = container || document.getElementById('edit-skills-list');
            
            const tag = document.createElement('span');
            tag.className = 'skill-tag';
            tag.innerHTML = `
                ${skill}
                <i class="fas fa-times" onclick="this.parentElement.remove()"></i>
            `;
            
            skillsList.appendChild(tag);
        }

        /**
         * Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
         */
        async function saveProfile() {
            try {
                const user = auth.getCurrentUser();
                if (!user) return;
                
                // Ø¬Ù…Ø¹ Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª
                const skills = [];
                document.querySelectorAll('#edit-skills-list .skill-tag').forEach(tag => {
                    skills.push(tag.childNodes[0].nodeValue.trim());
                });
                
                const profileData = {
                    full_name: document.getElementById('edit-name').value,
                    job_title: document.getElementById('edit-title').value,
                    location: document.getElementById('edit-location').value,
                    bio: document.getElementById('edit-bio').value,
                    twitter: document.getElementById('edit-twitter').value,
                    linkedin: document.getElementById('edit-linkedin').value,
                    github: document.getElementById('edit-github').value,
                    youtube: document.getElementById('edit-youtube').value,
                    skills: skills,
                    updated_at: new Date().toISOString()
                };
                
                const { error } = await supabase.client
                    .from('users')
                    .update(profileData)
                    .eq('id', user.id);
                
                if (error) throw error;
                
                auth.showNotification('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                closeEditModal();
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                await loadProfileData();
                
            } catch (error) {
                console.error('Save profile error:', error);
                auth.showNotification('âŒ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ', 'error');
            }
        }

        /**
         * ØªØºÙŠÙŠØ± ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù
         */
        function changeCover() {
            auth.showNotification('ğŸ–¼ï¸ Ø¬Ø§Ø±ÙŠ ØªØºÙŠÙŠØ± ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù...', 'info');
            // TODO: ØªÙ†ÙÙŠØ° ØªØºÙŠÙŠØ± ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù
        }

        /**
         * ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©
         */
        function editAvatar() {
            window.location.href = 'settings.html#profile';
        }

        /**
         * Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
         */
        async function shareProfile() {
            const userId = profileUserId || auth.getCurrentUser()?.id;
            const url = `${window.location.origin}/pages/profile.html?id=${userId}`;
            
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ ÙÙŠ ØªØ¹Ù„ÙŠÙ…ÙŠ',
                        text: `ØªØ¹Ø±Ù Ø¹Ù„Ù‰ ${currentUser?.full_name || 'Ù…Ø³ØªØ®Ø¯Ù…'} ÙÙŠ ØªØ¹Ù„ÙŠÙ…ÙŠ`,
                        url: url
                    });
                } catch (error) {
                    console.error('Share error:', error);
                }
            } else {
                await Utils.copyToClipboard(url);
                auth.showNotification('âœ… ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ', 'success');
            }
        }

        /**
         * Ø¥Ø¸Ù‡Ø§Ø± Ø®Ø·Ø£
         */
        function showError(message) {
            auth.showNotification(message, 'error');
        }

        /**
         * ØªØµØ¯ÙŠØ± Ø§Ù„Ø¯ÙˆØ§Ù„ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ø§Ù…
         */
        window.editProfile = editProfile;
        window.closeEditModal = closeEditModal;
        window.saveProfile = saveProfile;
        window.addSkill = addSkill;
        window.changeCover = changeCover;
        window.editAvatar = editAvatar;
        window.shareProfile = shareProfile;
    </script>
</body>
</html>